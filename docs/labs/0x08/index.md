# 实验八：扩展实验

!!! tip "<br/>&nbsp;<span style="font-weight: bold; float: right">by</span>"

## 实验任务与要求

请从下列任务中，选择一到两个目标进行实现：

### 可读写的临时文件系统

根据现有的其他 OS 实验中的文件系统设计、或参考现有的文件系统设计，结合你学过的算法、组织数据的方式，实现一个简单的文件系统的驱动。

可以是目录结构文件系统（例如参考 FAT32），可以是日志文件系统（例如参考 ext4、NTFS）。实现之后利用帧分配器在操作系统初始化分配一段内存空间，将其作为块设备，使用你的文件系统对其进行格式化、挂载、读写等操作。为了更好的实现你可能需要适当增大启动 OS 的内存量。

#### 实现目标

1. 将启动目录挂载至 `/boot` 目录下。
2. 将临时文件系统挂载至 `/tmp` 目录下。
3. 创建 `/tmp/mydir` 目录。
4. 创建 `/tmp/mydir/hello.txt` 文件。
5. 向 `/tmp/mydir/hello.txt` 文件写入一段字符序列，包含你的学号。
6. 读取 `/tmp/mydir/hello.txt` 文件，将其中的字符序列打印到屏幕上。

#### 加分项

1. 尝试实现文件系统的硬链接，并测试读写操作。
2. 修改 QEMU 参数，挂载一块虚拟磁盘，尝试实现文件的持久化。

### VGA 显示输出

串口输出只是最基本的交互方式，尝试在 bootloader 中，利用 `get_handle_for_protocol::<GraphicsOutput>` 获取到 VGA 显示的模式、分辨率、缓冲区地址等信息。

之后通过利用 `embedded-graphics` 等库，实现一个简单的图形输出驱动，赋予操作系统绘制图形的能力，之后实现一个简单的 Shell 显示，并激活键盘输入的驱动，通过和串口启动共享缓冲区的方式，响应键盘输入。

#### 实现目标

1. 在 bootloader 中，获取图形输出的相关信息，并传递给内核。
2. 实现一个简单的图形输出驱动，支持基本的 VGA 图形绘制操作。
3. 利用 `embedded-graphics` 实现字符渲染。
4. 为 VGA 显示实现一个 Shell 输出，使其能够输出字符、清屏等，并将其对接到合适的日志输出。

#### 加分项

1. 利用键盘输入中断，为 QEMU 的 GUI 界面实现输入输出。
2. 尝试将 Shell 部分限制在屏幕的下半部分，并在上半部分实现一些图像的绘制。作为一个例子，你可以利用 `sleep` 等方式，实现一个不断绘制转动的钟表的进程，并让它作为一个后台进程运行。
